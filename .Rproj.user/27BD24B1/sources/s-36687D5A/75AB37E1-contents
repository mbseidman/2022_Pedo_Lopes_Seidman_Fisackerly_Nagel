---
title: "Project D"
author: "Wil Fisackerly"
date: "19 July 2021"
output:
  html_notebook: default
  pdf_document: default
---

```{r include=FALSE}

# Reset the environment

rm(list = ls())

# Load libraries

library(here)
library(data.table)
library(tidyverse)
library(httr)
library(formattable)

# Setting custom colors

customGreen0 = "#DeF7E9"

customGreen = "#71CA97"

customRed = "#ff7f7f"

customYellow = "#FFFF00"

# Load data

covid <- read_csv("https://api.covidactnow.org/v2/states.csv?apiKey=3978488c8802497baa264682d43b970f")

# Functions

percent <- function(x, digits = 2, format = "f", ...) {      
  paste0(formatC(x * 100, format = format, digits = digits, ...), "%")
}

```

### Description

The start of the 2020 decade saw the emergence of one of the worst pandemics the
human race has encountered in nearly a century. Since its first cases at the end
of 2019, over 190 million people have become infected with the novel 
coronavirus, with nearly 4.1 million deaths. Human tenacity has prevailed
numerous COVID-19 vaccines that are readily accessible for most citizens of
modern nations, a crucial step in the fight against the virus. There has been 
skepticism on the effectiveness on the vaccines, specifically in the context of
new variants of the virus. The purpose of this report to analyze COVID-19 data 
from the United States to determine if the rate of virus cases is related to the
rate of vaccination. If the vaccine manufacturers and government officials are
to be believed, vaccination should reduce the number of COVID cases and the
severity of COVID symptoms, including hospitalizations.


Reference: *Covid-19 coronavirus pandemic*. (2021, July 18). Worldometers.info.
Retrieved July 17, 2021 from https://www.worldometers.info/coronavirus/.

### Analysis

Before we can discuss the COVID case rate for each state, we should first see
how each state is performing at vaccination. To evaluate this we will look at 
vaccinations completed ratio. Figure 1 is a histogram that displays the 
frequency of the ratio of a state's population that has completed vaccination.

```{r echo=FALSE}

# Histogram of Vaccination Completed Ratio

ggplot(covid, aes(x = metrics.vaccinationsCompletedRatio)) +
  theme_minimal() +
  geom_histogram(fill = "orange", 
                 color = "black", 
                 binwidth = .025) +
  scale_y_continuous(limits = c(0, 15)) +
  labs(x = "Vaccination Completed Ratio", 
       y = "Frequency", 
       title = "Frequency of Vaccination Completed RATIO",
       subtitle = "Using Covid ActNow data")

half_vax <- percent((sum(covid$metrics.vaccinationsCompletedRatio > .5))/53)


```
*Figure 1: Vaccinations Completed Ratio*

As of the construction of this report, about `r half_vax` of the 53 states and 
territories from the COVID ActNow data have completed vaccinations over 50
percent of its population. How does the completed vaccination compare to the 
current COVID case density? Figure 2 displays both for each state.

```{r echo=FALSE, warning=FALSE}

# Histogram of Vaccination Completed Ratio by State

ggplot(covid, aes(x = metrics.vaccinationsCompletedRatio,
                                    y = metrics.caseDensity)) +
  theme_minimal() +
  geom_point(color = "black") +
  geom_text(aes(label = ifelse(metrics.caseDensity > 20,
                               as.character(state),'')),
            hjust = -.25, 
            vjust = -.25) +
  geom_text(aes(label = ifelse(metrics.vaccinationsCompletedRatio > .628,
                               as.character(state),'')),
            hjust = -.25, 
            vjust = -.25) +
  geom_text(aes(label = ifelse(state == "SC", as.character(state),'')),
            hjust = -.25, 
            vjust = -.25) +
  scale_x_continuous(limits = c(0.3, .7)) +
  scale_y_continuous(limits = c(0, 35)) +
  geom_smooth(formula = y ~ x, method = "lm") +
  labs(x = "Vaccination Completed Ratio", 
       y = "Case Density per 100,000", 
       title = "Case Density by Vaccination Completed Ratio",
       subtitle = "Using Covid ActNow data")

corr_covid_vaccine <- cor.test(covid$metrics.vaccinationsCompletedRatio,
                               covid$metrics.caseDensity)

```
*Figure 2: Case Density by Vaccination Completed Ratio*

The downward shape of the correlation line indicate negative correlation between
the vaccination completed ratio and the case density per 100,000. States with
less than 50 percent completed vaccination have case densities per 100,000 above
20, including Arkansas (`r covid[[3, 12]]`), Missouri (`r covid[[25, 12]]`), 
Florida (`r covid[[10, 12]]`), Louisiana (`r covid[[19, 12]]`), and Nevada 
(`r covid[[35, 12]]`). Massachusetts (`r covid[[20, 12]]`) and Vermont 
(`r covid[[49, 12]]`) have low case densities in comparison as the leading
states in vaccination completed ratio.

There is a moderate negative relationship between the COVID case density per
100,000 people and the vaccination completed ratio of a state. The p-value for 
this correlation is less than .05 and the correlation is 
`r (corr_covid_vaccine$estimate)`.

***

South Carolina appears to slot into the middle of the pack in terms of COVID 
case density per 100,000. Let's take a look at some basic statistics for each
state. Table 1 lists the population, case density per 100,000, infection rate,
and vaccinations completed ratio for each state.

```{r echo=FALSE}

state_table <- covid[,c(3, 9, 12, 14, 49)]

state_table$`Case Density Rank` <-
  (round(frank(-state_table$metrics.caseDensity)))

state_table$`VCR Rank` <-
  (round(frank(-state_table$metrics.vaccinationsCompletedRatio)))

colnames(state_table) <- c("State", 
                           "Population", 
                           "Case Density", 
                           "Infection Rate",
                           "VCR",
                           "Case Density Rank",
                           "VCR Rank")

formattable(state_table, 
            align =c("l","c","c","c", "c", "c", "c"), 
            list(`Indicator Name` = formatter("span", 
                                              style = ~ style(color = "grey", 
                                                              font.weight = 
                                                                "bold")),
                 `Case Density`= color_tile(customYellow, customRed),
                 `Infection Rate`= color_tile(customYellow, customRed),
                 `Case Density Rank` = color_tile(customRed, customYellow),
                 `VCR`= color_tile(customYellow,
                                                            customGreen),
                 `VCR Rank`= color_tile(customGreen, customYellow)))

```
*Table 1: Statistics for States*

South Carolina ranks `r state_table[[43,6]]`st in case density per 100,000 and
ranks `r state_table[[43,7]]`nd in vaccinations completed ratio (VCR). South 
Carolina has one of the smaller populations in the United States at 5,148,714. 
This makes the vaccinations completed ratio of `r state_table[[43,5]]` seem less
impressive than a state like California, who has a VCR of `r state_table[[5,5]]`
despite a population nearly eight times larger than South Carolina at 
39,512,223.

***

### Conclusions

The purpose of this report was to analyze COVID-19 data from the United States 
to determine if the rate of virus cases is related to therate of vaccination. 
Initial data indicates a negative correlation between a state's vaccinations
completed ratio and its' COVID case density per 100,000. A further analysis of
the state of South Carolina ranked the state as `r state_table[[43,6]]`st worst
in case density per 100,000 and `r state_table[[43,7]]`nd best in VCR. Though
most South Carolinians have access to a vaccine, the state still lags behind 
states with larger populations despite its relative size.
